!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("filofax",[],t):"object"==typeof exports?exports.filofax=t():e.filofax=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=function(){function e(t){n(this,e),this.lifetime=6e4,this.shottime=1e4,this.maxSize=this.lifetime/this.shottime,this.stack=[];for(var r=0,o=this.maxSize-1;o>=r;r++)this.stack[r]={};this.startime=performance.now()}return o(e,[{key:"shot",value:function(e){var t=performance.now(),r=t-this.startime,n=Math.floor(r/this.shottime%this.maxSize),o=this.stack[n];if(e instanceof Error)var a=i.parse(e);else var a=i.get(e);if(o){var s=Object.keys(o);-1===s.indexOf(a.rootToken)&&(o[a.rootToken]=[]),o[a.rootToken].push(a.toString())}}},{key:"dump",value:function(){console.log(this.stack)}},{key:"upload",value:function(){}}]),e}();e.exports=a},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(2),Error.stackTraceLimit=1/0;var i=r(8),a=r(7),s=function(){function e(){n(this,e)}return o(e,null,[{key:"makeToken",value:function(e){return e+":"+performance.now()}},{key:"get",value:function(t){var r=new Error;Error.captureStackTrace(r,arguments.callee);var n=r.callSite.mutated;console.log("get stack length with:",n.length),lastStackFrame=r.lastStackFrame?r.lastStackFrame:a.stackframe,console.log("get lastStackFrame:",lastStackFrame);var o=n[1],s=o.getFunctionName(),u=o.getTypeName();if(t&&"root"===t.type)var c=e.makeToken(u+":"+s),l=null,f=c;else var c=lastStackFrame.rootToken,l=lastStackFrame.token,f=e.makeToken(u+":"+s);var m=o.getFunction(),p=Array.prototype.slice.call(m.arguments,0),h=new i({typeName:o.getTypeName(),functionName:o.getFunctionName(),fileName:o.getFileName(),args:p,lineNumber:o.getLineNumber(),columnNumber:o.getColumnNumber(),isConstructor:o.isConstructor(),isToplevel:o.isToplevel(),rootToken:c,parentToken:l,token:f});return a.stackframe=h,console.log(h.toString()),h}},{key:"parse",value:function(t){var r=/at (?:(.+)\s+\()?(?:(.+?):(\d+):(\d+)|([^)]+))\)?/,n=/([^\.]+)(?:\.(.+))?/,o=t.stack.split("\n"),s=o[0],u=o[1],c=u.match(r);if(c){if(c[1])var l=c[1].match(n),f=l[1],m=l[2];var p=c[2],h=Number(c[3]),v=Number(c[4])}var f=f?f:"",m=m?m:"",p=p?p:"",h=h?h:0,v=v?v:0,y=t.lastStackFrame?t.lastStackFrame:a.stackframe,k=new i({prefix:s,typeName:f,functionName:m,fileName:p,args:[],lineNumber:h,columnNumber:v,rootToken:y.rootToken,parentToken:y.token,token:e.makeToken(f+":"+m)});return console.log(k.toString()),k}}]),e}();e.exports=s},function(e,t,r){function n(e){var t=Error.stackTraceLimit;Error.stackTraceLimit=t+e;var r=u.callSite({extend:!1,filter:!0,slice:e});return Error.stackTraceLimit=t,r}function o(e,t,r){console.log("async init",e);var o=n(2);o.push.apply(o,null===r?m:h.get(r)),o.splice(Error.stackTraceLimit),h.set(e,o),v.set(e,f.stackframe)}function i(e){m=h.get(e),p=v.get(e)}function a(e){m=null,p=null}function s(e){h["delete"](e),v["delete"](e)}var u=r(3),c=r(5),l=new c,f=r(7),m=null,p=null,h=new Map,v=new Map;l.add({init:o,pre:i,post:a,destroy:s}),l.enable(),u.extend.attach(function(e,t){return p&&(e.lastStackFrame=p),t.push.apply(t,m),t})},function(e,t,r){function n(){this.extend=new o,this.filter=new o,this.format=new i}function o(){this._modifiers=[]}function i(){this._formater=u,this._previous=void 0}function a(e,t){if(c)return t;var r=t.concat();return r=l.extend._modify(e,r),r=l.filter._modify(e,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(e)&&void 0===Object.getOwnPropertyDescriptor(e,"callSite")&&(e.callSite={original:t,mutated:r}),l.format._formater(e,r)}function s(){return this.stack,this.callSite}var u=r(4),c=!1;n.prototype.callSite=function f(e){e||(e={}),c=!0;var t={};Error.captureStackTrace(t,f);var r=t.stack;return c=!1,r=r.slice(e.slice||0),e.extend&&(r=this.extend._modify(t,r)),e.filter&&(r=this.filter._modify(t,r)),r};var l=new n;o.prototype._modify=function(e,t){for(var r=0,n=this._modifiers.length;n>r;r++)t=this._modifiers[r](e,t);return t},o.prototype.attach=function(e){this._modifiers.push(e)},o.prototype.deattach=function(e){var t=this._modifiers.indexOf(e);return-1===t?!1:(this._modifiers.splice(t,1),!0)},i.prototype.replace=function(e){e?this._formater=e:this.restore()},i.prototype.restore=function(){this._formater=u},i.prototype._backup=function(){this._formater===u?this._previous=void 0:this._previous=this._formater},i.prototype._roolback=function(){this.replace(this._previous),this._previous=void 0},Error.prepareStackTrace&&l.format.replace(Error.prepareStackTrace),Object.defineProperty(Error,"prepareStackTrace",{get:function(){return a},set:function(e){e===a?l.format._roolback():(l.format._backup(),l.format.replace(e))}}),Object.defineProperty(Error.prototype,"callSite",{get:s,set:function(e){Object.defineProperty(this,"callSite",{value:e,writable:!0,configurable:!0})},configurable:!0}),e.exports=l},function(e,t){e.exports=function(e,t){var r=[];r.push(e.toString());for(var n=0;n<t.length;n++){var o,i=t[n];try{o=i.toString()}catch(a){try{o="<error: "+a+">"}catch(s){o="<error>"}}r.push("    at "+o)}return r.join("\n")}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=Symbol("async-hook-uid"),a={timers:r(6)},s=function(){function e(){n(this,e),this.enabled=!1,this.counter=0;var t=this.initFns=[],r=this.preFns=[],o=this.postFns=[],s=this.destroyFns=[];this.init=function(e,r){this[i]=e,null!==r&&(r=r[i]);var n=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value;c(e,this,r)}}catch(l){o=!0,a=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw a}}},this.pre=function(){var e=this[i],t=!0,n=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var u=a.value;u(e,this)}}catch(c){n=!0,o=c}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw o}}},this.post=function(){var e=this[i],t=!0,r=!1,n=void 0;try{for(var a,s=o[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var u=a.value;u(e,this)}}catch(c){r=!0,n=c}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw n}}},this.destroy=function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=s[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;a(e)}}catch(u){r=!0,n=u}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw n}}};var u=!0,c=!1,l=void 0;try{for(var f,m=Object.keys(a)[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var p=f.value;a[p].call(this)}}catch(h){c=!0,l=h}finally{try{!u&&m["return"]&&m["return"]()}finally{if(c)throw l}}}return o(e,[{key:"add",value:function(e){e.init&&this.initFns.push(e.init),e.pre&&this.preFns.push(e.pre),e.post&&this.postFns.push(e.post),e.destroy&&this.destroyFns.push(e.destroy)}},{key:"remove",value:function(t){t.init&&e.removeElement(this.initFns,t.init),t.pre&&e.removeElement(this.preFns,t.pre),t.post&&e.removeElement(this.postFns,t.post),t.destroy&&e.removeElement(this.destroyFns,t.destroy)}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}}],[{key:"removeElement",value:function(e,t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}}]),e}();e.exports=s},function(e,t){function r(){}function n(){}function o(e,t,r,n,o,a,s){var u=i[r],c=i[n];i[r]=function(){if(!t.enabled)return u.apply(i,arguments);var r=Array.from(arguments),n=r[0],c=new o,l=--t.counter,f=void 0;return e.init.call(c,l,null),r[0]=function(){e.pre.call(c),n.apply(this,arguments),e.post.call(c),s&&(a["delete"](f),e.destroy.call(null,l))},f=u.apply(i,r),a.set(f,l),f},i[n]=function(t){if(a.has(t)){var r=a.get(t);a["delete"](t),e.destroy.call(null,r)}c.apply(i,arguments)}}var i=window,a=new Map,s=new Map;e.exports=function(){o(this,this,"setTimeout","clearTimeout",r,a,!0),o(this,this,"setInterval","clearInterval",n,s,!1)}},function(e,t){e.exports={stackframe:null}},function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),t instanceof Object?(this.prefix=t.prefix?t.prefix+"@":"",this.typeName=t.typeName||"Object",this.functionName=t.functionName||"",this.fileName=t.fileName||"",this.source=t.source||"",this.args=t.args||[],this.lineNumber=e.isNumber(t.lineNumber)?t.lineNumber:0,this.columnNumber=e.isNumber(t.columnNumber)?t.columnNumber:0,this.isConstructor=t.isConstructor,this.isToplevel=t.isToplevel,this.rootToken=t.rootToken||null,this.parentToken=t.parentToken||null,this.token=t.token||null,window.performance?this.time=window.performance.now():this.time=null):console.warn("stackframe arguments must be object!")}return n(e,[{key:"toString",value:function(){var e=this.getTypeName()||"",t=this.getFunctionName()||"{anonymous}",r=this.getArgs().join(","),n=this.getFileName(),o=this.getLineNumber(),i=this.getColumnNumber(),a=this.getRootToken(),s=this.getParentToken(),u=this.getToken();return""+this.prefix+e+"."+t+"("+r+")@"+n+":"+o+":"+i+"@"+a+"-"+s+"-"+u}},{key:"getTypeName",value:function(){return this.typeName}},{key:"getFunctionName",value:function(){return this.functionName}},{key:"getFileName",value:function(){return this.fileName}},{key:"getSource",value:function(){return this.source}},{key:"getArgs",value:function(){return this.args}},{key:"getLineNumber",value:function(){return this.lineNumber}},{key:"getColumnNumber",value:function(){return this.columnNumber}},{key:"isToplevel",value:function(){return this.isToplevel}},{key:"isConstructor",value:function(){return this.isConstructor}},{key:"getRootToken",value:function(){return this.rootToken}},{key:"getParentToken",value:function(){return this.parentToken}},{key:"getToken",value:function(){return this.token}}],[{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}]),e}();e.exports=o}])});
//# sourceMappingURL=filofax.min.js.map